1) Refactor to factory pattern on instruction decoders
2) Rework driver code to generic consumer-producer

